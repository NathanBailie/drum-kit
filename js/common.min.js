"use strict";const buttons=document.querySelectorAll(".button"),recordButton=document.querySelector(".button.record"),playButton=document.querySelector(".button.play"),base="./assets/sounds/",sounds={KeyA:`${base}clap.wav`,KeyS:`${base}hihat.wav`,KeyD:`${base}kick.wav`,KeyF:`${base}openhat.wav`,KeyG:`${base}boom.wav`,KeyH:`${base}ride.wav`,KeyJ:`${base}snare.wav`,KeyK:`${base}tom.wav`,KeyL:`${base}tink.wav`},keys=Object.keys(sounds);let pressedBtnsKeyCodes=[],timings=[],isRecording=!1,isPlaying=!1;function toggleButton(e,t){e.classList[t?"add":"remove"]("active")}function keyPressHandle(e){if(!keys.includes(String(e)))return;const t=document.querySelector(`.button[data-key="${e}"]`);toggleButton(t,!0),onPlaySound(e),isRecording&&onRecord(e),document.addEventListener("keyup",(()=>toggleButton(t,!1)),{once:!0})}function onRecordHandler(){if(isRecording=!isRecording,!isRecording)return toggleButton(recordButton,!1),void(recordButton.querySelector(".sound").textContent="record");pressedBtnsKeyCodes=[],timings=[],toggleButton(recordButton,!0),recordButton.querySelector(".sound").textContent="stop",toggleButton(playButton,!1)}function onRecord(e){pressedBtnsKeyCodes.push(e),timings.push(Date.now())}function onPlayRecord(){if(0===timings.length||isPlaying)return;isPlaying=!0,toggleButton(playButton,!0);const e=onCalcTimeDiffs(timings);let t=0;e.forEach(((e,o)=>{t+=e,setTimeout((()=>onPlaySound(pressedBtnsKeyCodes[o])),t)})),setTimeout((()=>{toggleButton(playButton,!1),isPlaying=!1}),t+400)}function onCalcTimeDiffs(e){return[0,...e.slice(1).map(((t,o)=>t-e[o]))]}function onPlaySound(e){new Audio(sounds[e]).play()}document.addEventListener("keydown",(e=>{keyPressHandle(e.code),"KeyR"===e.code?onRecordHandler():"KeyP"===e.code&&onPlayRecord()})),document.addEventListener("click",(e=>{const t="SPAN"===e.target.tagName?e.target.closest("BUTTON"):e.target,o=t.dataset.key;keyPressHandle(o),keys.includes(String(o))&&toggleButton(t,!1)})),recordButton.addEventListener("click",(()=>{onRecordHandler(),toggleButton(playButton,!1)})),playButton.addEventListener("click",(()=>{onPlayRecord(),toggleButton(recordButton,!1)}));